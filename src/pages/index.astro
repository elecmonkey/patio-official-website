---
import Layout from '@/layouts/Layout.astro';
import { getLangFromUrl, useTranslations } from '@/i18n/utils';
import { getRelativeLocaleUrl } from 'astro:i18n';
import CompanyCarousel from '@/components/CompanyCarousel';
import picCompany1 from '@/assets/company/pic1.jpg';
import picCompany2 from '@/assets/company/pic2.jpg';
import picCompany3 from '@/assets/company/pic3.jpg';
import worldMapGrid from '@/assets/world_map_grid.svg';
import iconOrcid from '@/assets/academicons/academicons-orcid.svg';
import iconMendeley from '@/assets/academicons/academicons-mendeley.svg';
import iconOpenData from '@/assets/academicons/academicons-open-data.svg';
import iconINaturalist from '@/assets/academicons/academicons-inaturalist.svg';
import iconMathoverflow from '@/assets/academicons/academicons-mathoverflow.svg';
import iconStackoverflow from '@/assets/academicons/academicons-stackoverflow.svg';
import iconElsevier from '@/assets/academicons/academicons-elsevier.svg';
import iconJstor from '@/assets/academicons/academicons-jstor.svg';
import iconClarivate from '@/assets/academicons/academicons-clarivate.svg';
import iconArxiv from '@/assets/academicons/academicons-arxiv.svg';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const brand = lang === 'en' ? 'Patio Academy' : '攀梯国际';

const featureIconMap = {
  mentors: iconOrcid.src,
  personalized: iconMendeley.src,
  feedback: iconOpenData.src,
  environment: iconINaturalist.src
} as const;

const features = [
  { icon: 'mentors', title: t('home.features.mentors.title'), description: t('home.features.mentors.desc') },
  { icon: 'personalized', title: t('home.features.personalized.title'), description: t('home.features.personalized.desc') },
  { icon: 'feedback', title: t('home.features.feedback.title'), description: t('home.features.feedback.desc') },
  { icon: 'environment', title: t('home.features.environment.title'), description: t('home.features.environment.desc') }
].map((item) => ({
  ...item,
  iconSrc: featureIconMap[item.icon as keyof typeof featureIconMap] ?? ''
}));

const curriculumPrograms = [
  {
    code: 'A-Level',
    title: t('home.curriculum.alevel.title'),
    summary: t('home.curriculum.alevel.desc')
  },
  {
    code: 'AP',
    title: t('home.curriculum.ap.title'),
    summary: t('home.curriculum.ap.desc')
  },
  {
    code: 'IB',
    title: t('home.curriculum.ib.title'),
    summary: t('home.curriculum.ib.desc')
  },
  {
    code: 'WACE',
    title: t('home.curriculum.wace.title'),
    summary: t('home.curriculum.wace.desc')
  }
];

const fulltimeAudience = t('home.fulltime.audience.items').split('｜');
const fulltimeHighlights = features;

const competitionIconMap = {
  math: iconMathoverflow.src,
  cs: iconStackoverflow.src,
  chem: iconElsevier.src,
  bio: iconINaturalist.src,
  humanity: iconJstor.src,
  business: iconClarivate.src,
  physics: iconArxiv.src
} as const;

const competitionCategories = [
  {
    key: 'math',
    title: t('home.competition.categories.math.title'),
    description: t('competitions.categories.math.desc')
  },
  {
    key: 'cs',
    title: t('home.competition.categories.cs.title'),
    description: t('competitions.categories.cs.desc')
  },
  {
    key: 'chem',
    title: t('home.competition.categories.chem.title'),
    description: t('competitions.categories.chem.desc')
  },
  {
    key: 'bio',
    title: t('home.competition.categories.bio.title'),
    description: t('competitions.categories.bio.desc')
  },
  {
    key: 'humanity',
    title: t('home.competition.categories.humanity.title'),
    description: t('competitions.categories.humanity.desc')
  },
  {
    key: 'business',
    title: t('home.competition.categories.business.title'),
    description: t('competitions.categories.business.desc')
  },
  {
    key: 'physics',
    title: t('home.competition.categories.physics.title'),
    description: t('competitions.categories.physics.desc')
  }
].map((item) => ({
  ...item,
  iconSrc: competitionIconMap[item.key as keyof typeof competitionIconMap] ?? ''
}));

const oxbridgePainPoints = t('home.oxbridge.pains.items').split('｜');
const oxbridgeServices = t('home.oxbridge.services.items').split('｜');
const trustPoints = t('home.about.points').split('｜');
const aboutCarouselCaptions = t('home.about.carousel.captions').split('｜');
const companyGallery = [
  { src: picCompany1.src, caption: aboutCarouselCaptions[0] ?? '', alt: aboutCarouselCaptions[0] ?? 'Company workspace' },
  { src: picCompany2.src, caption: aboutCarouselCaptions[1] ?? '', alt: aboutCarouselCaptions[1] ?? 'Company classroom space' },
  { src: picCompany3.src, caption: aboutCarouselCaptions[2] ?? '', alt: aboutCarouselCaptions[2] ?? 'Company lounge area' }
];
const fallbackImage = companyGallery[0];
---

<Layout title={`${t('nav.home')} - ${brand}`}>
  <section class="hero relative min-h-[60vh] bg-base-200 overflow-hidden">
    <div class="absolute inset-0">
      <img src={worldMapGrid.src} alt="" class="w-full h-full object-cover mix-blend-multiply" style="filter: grayscale(100%) contrast(115%);" />
      <div class="absolute inset-0 bg-gradient-to-b from-base-100/60 via-base-200/80 to-base-200"></div>
    </div>
    <div class="relative hero-content text-center py-24">
      <div class="max-w-6xl mx-auto space-y-8 px-4">
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold leading-tight tracking-tight space-y-2" style="animation: slideInFromLeft 0.6s ease-out">
          <span class="block">{t('home.hero.title')}</span>
          <span class="block text-primary">{t('home.hero.titleHighlight')}</span>
        </h1>
        <p class="text-lg sm:text-xl leading-relaxed opacity-80" style="animation: slideInFromLeft 0.6s ease-out 0.2s both">
          {t('home.hero.subtitle')}
        </p>
        <div class="flex flex-col sm:flex-row justify-center gap-4" style="animation: slideInFromLeft 0.6s ease-out 0.3s both">
          <a href={getRelativeLocaleUrl(lang, 'contact')} class="btn btn-primary btn-lg">
            {t('home.hero.primaryCta')}
          </a>
          <a href={getRelativeLocaleUrl(lang, 'international-subjects')} class="btn btn-outline btn-lg">
            {t('home.hero.secondaryCta')}
          </a>
        </div>
      </div>
    </div>
  </section>

  <section class="bg-base-200 py-20 md:py-28">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16" style="animation: slideInFromLeft 0.6s ease-out both">
        <h2 class="text-3xl sm:text-4xl font-bold mb-4">{t('home.curriculum.title')}</h2>
        <p class="text-lg opacity-80">{t('home.curriculum.subtitle')}</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 md:gap-8">
        {curriculumPrograms.map((program, index) => (
          <div class="card card-border bg-base-100 h-full" style={`animation: slideInFromLeft 0.6s ease-out ${0.1 * index}s both`}>
            <div class="card-body space-y-4">
              <div class="badge badge-ghost uppercase tracking-wide w-fit">{program.code}</div>
              <h3 class="text-xl font-semibold leading-tight">{program.title}</h3>
              <p class="text-sm opacity-80 leading-relaxed" style="display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden;">{program.summary}</p>
            </div>
          </div>
        ))}
      </div>
      <div class="text-center mt-12">
        <a href={getRelativeLocaleUrl(lang, 'international-subjects')} class="btn btn-primary btn-lg">
          {t('home.curriculum.cta')}
        </a>
      </div>
    </div>
  </section>

  <section class="py-20 md:py-28">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid lg:grid-cols-2 gap-12 items-center">
      <div style="animation: slideInFromLeft 0.6s ease-out both">
        <h2 class="text-3xl sm:text-4xl font-bold mb-6">{t('home.fulltime.title')}</h2>
        <p class="text-lg opacity-80 mb-8">{t('home.fulltime.subtitle')}</p>
        <h3 class="text-xl font-semibold mb-4">{t('home.fulltime.audience.title')}</h3>
        <ul class="space-y-3 text-sm sm:text-base">
          {fulltimeAudience.map((item) => (
            <li class="flex items-start gap-3">
              <span class="mt-1 text-primary">•</span>
              <span class="opacity-80 leading-relaxed">{item}</span>
            </li>
          ))}
        </ul>
        <a href={getRelativeLocaleUrl(lang, 'fulltime')} class="btn btn-primary mt-10">
          {t('home.fulltime.cta')}
        </a>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4" style="animation: slideInFromLeft 0.6s ease-out 0.2s both">
        {fulltimeHighlights.map((item, index) => (
          <div class="card card-border bg-base-100" style={`animation: slideInFromLeft 0.6s ease-out ${0.1 * index}s both`}>
            <div class="card-body gap-3">
              {item.iconSrc && (
                <div class="w-12 h-12 rounded-full bg-primary/10 text-primary flex items-center justify-center">
                  <img src={item.iconSrc} alt={item.title} class="w-6 h-6 object-contain" loading="lazy" />
                </div>
              )}
              <h4 class="text-lg font-semibold">{item.title}</h4>
              <p class="text-sm opacity-80 leading-relaxed">{item.description}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <section class="bg-base-200 py-20 md:py-28">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16" style="animation: slideInFromLeft 0.6s ease-out both">
        <h2 class="text-3xl sm:text-4xl font-bold mb-4">{t('home.competition.title')}</h2>
        <p class="text-lg opacity-80">{t('home.competition.subtitle')}</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
        {competitionCategories.map((category, index) => (
          <div class="card card-border bg-base-100 h-full" style={`animation: slideInFromLeft 0.6s ease-out ${0.1 * index}s both`}>
            <div class="card-body gap-3">
              <div class="flex items-start gap-3">
                {category.iconSrc && (
                  <div class="w-12 h-12 rounded-full bg-primary/10 text-primary flex items-center justify-center flex-shrink-0">
                    <img src={category.iconSrc} alt={category.title} class="w-6 h-6 object-contain" loading="lazy" />
                  </div>
                )}
                <div class="space-y-2">
                  <h3 class="text-xl font-semibold">{category.title}</h3>
                  <p class="text-sm opacity-80 leading-relaxed" style="display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden;">{category.description}</p>
                </div>
              </div>
            </div>
          </div>
        ))}
      </div>
      <div class="text-center mt-12">
        <a href={getRelativeLocaleUrl(lang, 'competitions')} class="btn btn-outline">
          {t('home.competition.cta')}
        </a>
      </div>
    </div>
  </section>

  <section class="py-20 md:py-28 bg-gradient-to-r from-primary/10 via-base-100 to-primary/10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid lg:grid-cols-2 gap-12 items-start">
      <div class="card card-border bg-base-100" style="animation: slideInFromLeft 0.6s ease-out both">
        <div class="card-body gap-4">
          <h3 class="text-2xl font-bold text-primary">{t('home.oxbridge.title')}</h3>
          <p class="text-base opacity-80">{t('home.oxbridge.subtitle')}</p>
          <h4 class="text-lg font-semibold mt-4">{t('home.oxbridge.pains.title')}</h4>
          <ul class="space-y-3 text-sm opacity-80 leading-relaxed">
            {oxbridgePainPoints.map((item) => (
              <li class="flex items-start gap-3">
                <span class="text-primary mt-1">•</span>
                <span>{item}</span>
              </li>
            ))}
          </ul>
        </div>
      </div>
      <div class="card card-border bg-base-100" style="animation: slideInFromLeft 0.6s ease-out 0.2s both">
        <div class="card-body gap-4">
          <h4 class="text-lg font-semibold">{t('home.oxbridge.services.title')}</h4>
          <ul class="space-y-3 text-sm opacity-80 leading-relaxed">
            {oxbridgeServices.map((item) => (
              <li class="flex items-start gap-3">
                <span class="text-primary mt-1">•</span>
                <span>{item}</span>
              </li>
            ))}
          </ul>
          <a href={getRelativeLocaleUrl(lang, 'oxbridge')} class="btn btn-primary mt-6">
            {t('home.oxbridge.cta')}
          </a>
        </div>
      </div>
    </div>
  </section>

  <section class="py-20 md:py-28">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 text-center space-y-8" style="animation: slideInFromLeft 0.6s ease-out both">
      <h2 class="text-3xl sm:text-4xl font-bold">{t('home.about.title')}</h2>
      <p class="text-lg opacity-80 leading-relaxed">{t('home.about.subtitle')}</p>
      <div class="flex flex-col sm:flex-row justify-center gap-4 text-base font-medium">
        {trustPoints.map((point) => (
          <span class="badge badge-ghost px-4 py-3 text-sm sm:text-base">{point}</span>
        ))}
      </div>
      <div class="mt-10" style="animation: slideInFromLeft 0.6s ease-out 0.1s both">
        <CompanyCarousel images={companyGallery} client:visible>
          {fallbackImage && (
            <figure slot="fallback" class="relative w-full max-w-6xl mx-auto h-[26rem] sm:h-[34rem] lg:h-[38rem] overflow-hidden rounded-3xl shadow-2xl">
              <img src={fallbackImage.src} alt={fallbackImage.alt} class="w-full h-full object-cover" loading="lazy" />
            </figure>
          )}
        </CompanyCarousel>
      </div>
    </div>
  </section>

  <section class="bg-primary text-primary-content py-20 md:py-24">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center space-y-6">
      <h2 class="text-3xl sm:text-4xl font-bold">{t('home.cta.title')}</h2>
      <p class="text-lg opacity-90">{t('home.cta.subtitle')}</p>
      <div class="flex flex-col sm:flex-row justify-center gap-4">
        <a href={getRelativeLocaleUrl(lang, 'contact')} class="btn btn-neutral btn-lg">
          {t('home.cta.primary')}
        </a>
        <a href="tel:18061256544" class="btn btn-outline btn-lg text-primary-content border-primary-content/40 hover:bg-primary-content hover:text-primary">
          {t('home.cta.secondary')}
        </a>
      </div>
    </div>
  </section>
</Layout>
